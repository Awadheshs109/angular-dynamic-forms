import { Component } from '@angular/core';
import { FormGroup, Validators, FormControl } from '@angular/forms';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "./form-service.service";
import * as i3 from "@angular/common";
export class DynamicFormComponent {
    constructor(formBuilder, formService) {
        this.formBuilder = formBuilder;
        this.formService = formService;
        this.dynamicForm = this.formBuilder.group({});
    }
    ngOnInit() {
        const formStructure = this.formService.getFormStructure();
        let formGroup = {};
        formStructure.forEach((control) => {
            if (control.type === 'checkbox-group') {
                // Handle checkbox groups differently
                const checkboxControls = {};
                control.options.forEach((option) => {
                    checkboxControls[option.value] = new FormControl(option.checked || false);
                });
                formGroup[control.name] = this.formBuilder.group(checkboxControls);
            }
            else {
                // Handle all other controls
                let controlValidators = [];
                if (control.validations) {
                    control.validations.forEach((validation) => {
                        switch (validation.validator) {
                            case 'required':
                                controlValidators.push(Validators.required);
                                break;
                            case 'email':
                                controlValidators.push(Validators.email);
                                break;
                            case 'minLength':
                                controlValidators.push(Validators.minLength(validation.value));
                                break;
                            case 'maxLength':
                                controlValidators.push(Validators.maxLength(validation.value));
                                break;
                            case 'min':
                                controlValidators.push(Validators.min(validation.value));
                                break;
                            case 'max':
                                controlValidators.push(Validators.max(validation.value));
                                break;
                            case 'pattern':
                                controlValidators.push(Validators.pattern(validation.value));
                                break;
                            // Add more validators as needed
                        }
                    });
                }
                formGroup[control.name] = [control.value || '', controlValidators];
            }
        });
        this.dynamicForm = this.formBuilder.group(formGroup);
    }
    onSubmit() {
        if (this.dynamicForm.valid) {
            console.log('Form Submitted', this.dynamicForm.value);
            // Process form data here
        }
        else {
            console.log('Form is invalid');
            // Mark all fields as touched to show validation messages
            Object.values(this.dynamicForm.controls).forEach(control => {
                if (control instanceof FormGroup) {
                    Object.values(control.controls).forEach(subControl => {
                        subControl.markAsTouched();
                    });
                }
                else {
                    control.markAsTouched();
                }
            });
        }
    }
    getErrorMessage(control) {
        const formControl = this.dynamicForm.get(control.name);
        if (!formControl || !control.validations) {
            return '';
        }
        for (let validation of control.validations) {
            if (formControl.hasError(validation.name)) {
                return validation.message;
            }
            // Handle minlength/maxlength errors with their proper error keys
            if (validation.validator === 'minLength' && formControl.hasError('minlength')) {
                return validation.message;
            }
            if (validation.validator === 'maxLength' && formControl.hasError('maxlength')) {
                return validation.message;
            }
            if (validation.validator === 'min' && formControl.hasError('min')) {
                return validation.message;
            }
            if (validation.validator === 'max' && formControl.hasError('max')) {
                return validation.message;
            }
            if (validation.validator === 'pattern' && formControl.hasError('pattern')) {
                return validation.message;
            }
        }
        return '';
    }
    isCheckboxGroup(control) {
        return control.type === 'checkbox-group';
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: DynamicFormComponent, deps: [{ token: i1.FormBuilder }, { token: i2.FormService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.3", type: DynamicFormComponent, selector: "app-dynamic-form", ngImport: i0, template: "<form [formGroup]=\"dynamicForm\" (ngSubmit)=\"onSubmit()\">\r\n  <div *ngFor=\"let control of formService.formStructure\">\r\n    <!-- Text, Email, Number, Password, Textarea, Date -->\r\n    <div *ngIf=\"['text', 'email', 'number', 'password', 'textarea', 'date'].includes(control.type)\">\r\n      <label>{{control.label}}</label>\r\n      <textarea *ngIf=\"control.type === 'textarea'\" \r\n                [formControlName]=\"control.name\"\r\n                [placeholder]=\"control.label\"></textarea>\r\n      <input *ngIf=\"control.type !== 'textarea'\" \r\n             [type]=\"control.type\" \r\n             [formControlName]=\"control.name\"\r\n             [placeholder]=\"control.label\">\r\n      <span *ngIf=\"dynamicForm.controls[control.name]?.invalid && dynamicForm.controls[control.name]?.touched\">\r\n        {{getErrorMessage(control)}}\r\n      </span>\r\n    </div>\r\n\r\n    <!-- Select Dropdown -->\r\n    <div *ngIf=\"control.type === 'select'\">\r\n      <label>{{control.label}}</label>\r\n      <select [formControlName]=\"control.name\">\r\n        <option *ngFor=\"let option of control.options\" [value]=\"option.value\">{{option.label}}</option>\r\n      </select>\r\n      <span *ngIf=\"dynamicForm.controls[control.name]?.invalid && dynamicForm.controls[control.name]?.touched\">\r\n        {{getErrorMessage(control)}}\r\n      </span>\r\n    </div>\r\n\r\n    <!-- Radio Buttons -->\r\n    <div *ngIf=\"control.type === 'radio'\">\r\n      <label>{{control.label}}</label>\r\n      <div *ngFor=\"let option of control.options\" class=\"radio-option\">\r\n        <input type=\"radio\" \r\n               [formControlName]=\"control.name\" \r\n               [value]=\"option.value\"\r\n               [id]=\"control.name + option.value\">\r\n        <label [for]=\"control.name + option.value\">{{option.label}}</label>\r\n      </div>\r\n      <span *ngIf=\"dynamicForm.controls[control.name]?.invalid && dynamicForm.controls[control.name]?.touched\">\r\n        {{getErrorMessage(control)}}\r\n      </span>\r\n    </div>\r\n\r\n    <!-- Single Checkbox -->\r\n    <div *ngIf=\"control.type === 'checkbox'\">\r\n      <label class=\"checkbox-label\">\r\n        <input type=\"checkbox\" [formControlName]=\"control.name\">\r\n        {{control.label}}\r\n      </label>\r\n    </div>\r\n\r\n    <!-- Checkbox Group -->\r\n    <div *ngIf=\"isCheckboxGroup(control)\">\r\n      <label>{{control.label}}</label>\r\n      <div formGroupName=\"{{control.name}}\">\r\n        <div *ngFor=\"let option of control.options\" class=\"checkbox-option\">\r\n          <input type=\"checkbox\" \r\n                 [formControlName]=\"option.value\"\r\n                 [id]=\"control.name + option.value\">\r\n          <label [for]=\"control.name + option.value\">{{option.label}}</label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <button type=\"submit\" [disabled]=\"dynamicForm.invalid\">Submit</button>\r\n</form>", styles: ["form{max-width:600px;margin:0 auto;padding:20px;background:#f9f9f9;border-radius:8px}div{margin-bottom:15px}label{display:block;margin-bottom:5px;font-weight:700}input[type=text],input[type=email],input[type=number],input[type=password],input[type=date],select,textarea{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;box-sizing:border-box}textarea{min-height:100px}.radio-option,.checkbox-option{display:flex;align-items:center;margin-bottom:5px}.radio-option input,.checkbox-option input{margin-right:10px}.checkbox-label{display:flex;align-items:center}.checkbox-label input{margin-right:10px}span{color:#e74c3c;font-size:.8em;display:block;margin-top:5px}button{background-color:#3498db;color:#fff;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-size:1em}button:disabled{background-color:#95a5a6;cursor:not-allowed}button:hover:not(:disabled){background-color:#2980b9}\n"], dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i1.NgSelectOption, selector: "option", inputs: ["ngValue", "value"] }, { kind: "directive", type: i1.ɵNgSelectMultipleOption, selector: "option", inputs: ["ngValue", "value"] }, { kind: "directive", type: i1.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i1.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { kind: "directive", type: i1.SelectControlValueAccessor, selector: "select:not([multiple])[formControlName],select:not([multiple])[formControl],select:not([multiple])[ngModel]", inputs: ["compareWith"] }, { kind: "directive", type: i1.RadioControlValueAccessor, selector: "input[type=radio][formControlName],input[type=radio][formControl],input[type=radio][ngModel]", inputs: ["name", "formControlName", "value"] }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i1.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i1.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "directive", type: i1.FormGroupName, selector: "[formGroupName]", inputs: ["formGroupName"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: DynamicFormComponent, decorators: [{
            type: Component,
            args: [{ selector: 'app-dynamic-form', template: "<form [formGroup]=\"dynamicForm\" (ngSubmit)=\"onSubmit()\">\r\n  <div *ngFor=\"let control of formService.formStructure\">\r\n    <!-- Text, Email, Number, Password, Textarea, Date -->\r\n    <div *ngIf=\"['text', 'email', 'number', 'password', 'textarea', 'date'].includes(control.type)\">\r\n      <label>{{control.label}}</label>\r\n      <textarea *ngIf=\"control.type === 'textarea'\" \r\n                [formControlName]=\"control.name\"\r\n                [placeholder]=\"control.label\"></textarea>\r\n      <input *ngIf=\"control.type !== 'textarea'\" \r\n             [type]=\"control.type\" \r\n             [formControlName]=\"control.name\"\r\n             [placeholder]=\"control.label\">\r\n      <span *ngIf=\"dynamicForm.controls[control.name]?.invalid && dynamicForm.controls[control.name]?.touched\">\r\n        {{getErrorMessage(control)}}\r\n      </span>\r\n    </div>\r\n\r\n    <!-- Select Dropdown -->\r\n    <div *ngIf=\"control.type === 'select'\">\r\n      <label>{{control.label}}</label>\r\n      <select [formControlName]=\"control.name\">\r\n        <option *ngFor=\"let option of control.options\" [value]=\"option.value\">{{option.label}}</option>\r\n      </select>\r\n      <span *ngIf=\"dynamicForm.controls[control.name]?.invalid && dynamicForm.controls[control.name]?.touched\">\r\n        {{getErrorMessage(control)}}\r\n      </span>\r\n    </div>\r\n\r\n    <!-- Radio Buttons -->\r\n    <div *ngIf=\"control.type === 'radio'\">\r\n      <label>{{control.label}}</label>\r\n      <div *ngFor=\"let option of control.options\" class=\"radio-option\">\r\n        <input type=\"radio\" \r\n               [formControlName]=\"control.name\" \r\n               [value]=\"option.value\"\r\n               [id]=\"control.name + option.value\">\r\n        <label [for]=\"control.name + option.value\">{{option.label}}</label>\r\n      </div>\r\n      <span *ngIf=\"dynamicForm.controls[control.name]?.invalid && dynamicForm.controls[control.name]?.touched\">\r\n        {{getErrorMessage(control)}}\r\n      </span>\r\n    </div>\r\n\r\n    <!-- Single Checkbox -->\r\n    <div *ngIf=\"control.type === 'checkbox'\">\r\n      <label class=\"checkbox-label\">\r\n        <input type=\"checkbox\" [formControlName]=\"control.name\">\r\n        {{control.label}}\r\n      </label>\r\n    </div>\r\n\r\n    <!-- Checkbox Group -->\r\n    <div *ngIf=\"isCheckboxGroup(control)\">\r\n      <label>{{control.label}}</label>\r\n      <div formGroupName=\"{{control.name}}\">\r\n        <div *ngFor=\"let option of control.options\" class=\"checkbox-option\">\r\n          <input type=\"checkbox\" \r\n                 [formControlName]=\"option.value\"\r\n                 [id]=\"control.name + option.value\">\r\n          <label [for]=\"control.name + option.value\">{{option.label}}</label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <button type=\"submit\" [disabled]=\"dynamicForm.invalid\">Submit</button>\r\n</form>", styles: ["form{max-width:600px;margin:0 auto;padding:20px;background:#f9f9f9;border-radius:8px}div{margin-bottom:15px}label{display:block;margin-bottom:5px;font-weight:700}input[type=text],input[type=email],input[type=number],input[type=password],input[type=date],select,textarea{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;box-sizing:border-box}textarea{min-height:100px}.radio-option,.checkbox-option{display:flex;align-items:center;margin-bottom:5px}.radio-option input,.checkbox-option input{margin-right:10px}.checkbox-label{display:flex;align-items:center}.checkbox-label input{margin-right:10px}span{color:#e74c3c;font-size:.8em;display:block;margin-top:5px}button{background-color:#3498db;color:#fff;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-size:1em}button:disabled{background-color:#95a5a6;cursor:not-allowed}button:hover:not(:disabled){background-color:#2980b9}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.FormBuilder }, { type: i2.FormService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1mb3JtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2R5bmFtaWMtZm9ybS9zcmMvbGliL2R5bmFtaWMtZm9ybS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9keW5hbWljLWZvcm0vc3JjL2xpYi9keW5hbWljLWZvcm0uY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQUUsU0FBUyxFQUFlLFVBQVUsRUFBYSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7QUFRNUYsTUFBTSxPQUFPLG9CQUFvQjtJQUcvQixZQUFvQixXQUF3QixFQUFTLFdBQXdCO1FBQXpELGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVMsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFGN0UsZ0JBQVcsR0FBYyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUU2QixDQUFDO0lBRWxGLFFBQVE7UUFDTixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDMUQsSUFBSSxTQUFTLEdBQXdCLEVBQUUsQ0FBQztRQUV4QyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBVyxFQUFFLEVBQUU7WUFDcEMsSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLGdCQUFnQixFQUFFO2dCQUNyQyxxQ0FBcUM7Z0JBQ3JDLE1BQU0sZ0JBQWdCLEdBQWdDLEVBQUUsQ0FBQztnQkFDekQsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFXLEVBQUUsRUFBRTtvQkFDdEMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksV0FBVyxDQUFDLE1BQU0sQ0FBQyxPQUFPLElBQUks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LENBQUM7SUFFRCxlQUFlLENBQUMsT0FBWTtRQUMxQixPQUFPLE9BQU8sQ0FBQyxJQUFJLEtBQUssZ0JBQWdCLENBQUM7SUFDM0MsQ0FBQzs4R0EvR1Usb0JBQW9CO2tHQUFwQixvQkFBb0Isd0RDVGpDLGs2RkFrRU87OzJGRHpETSxvQkFBb0I7a0JBTGhDLFNBQVM7K0JBQ0Usa0JBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRm9ybUdyb3VwLCBGb3JtQnVpbGRlciwgVmFsaWRhdG9ycywgRm9ybUFycmF5LCBGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgRm9ybVNlcnZpY2UgfSBmcm9tICcuL2Zvcm0tc2VydmljZS5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYXBwLWR5bmFtaWMtZm9ybScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2R5bmFtaWMtZm9ybS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vZHluYW1pYy1mb3JtLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRHluYW1pY0Zvcm1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIGR5bmFtaWNGb3JtOiBGb3JtR3JvdXAgPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHt9KTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsIHB1YmxpYyBmb3JtU2VydmljZTogRm9ybVNlcnZpY2UpIHsgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGNvbnN0IGZvcm1TdHJ1Y3R1cmUgPSB0aGlzLmZvcm1TZXJ2aWNlLmdldEZvcm1TdHJ1Y3R1cmUoKTtcclxuICAgIGxldCBmb3JtR3JvdXA6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcclxuXHJcbiAgICBmb3JtU3RydWN0dXJlLmZvckVhY2goKGNvbnRyb2w6YW55KSA9PiB7XHJcbiAgICAgIGlmIChjb250cm9sLnR5cGUgPT09ICdjaGVja2JveC1ncm91cCcpIHtcclxuICAgICAgICAvLyBIYW5kbGUgY2hlY2tib3ggZ3JvdXBzIGRpZmZlcmVudGx5XHJcbiAgICAgICAgY29uc3QgY2hlY2tib3hDb250cm9sczogUmVjb3JkPHN0cmluZywgRm9ybUNvbnRyb2w+ID0ge307XHJcbiAgICAgICAgY29udHJvbC5vcHRpb25zLmZvckVhY2goKG9wdGlvbjogYW55KSA9PiB7XHJcbiAgICAgICAgICBjaGVja2JveENvbnRyb2xzW29wdGlvbi52YWx1ZV0gPSBuZXcgRm9ybUNvbnRyb2wob3B0aW9uLmNoZWNrZWQgfHwgZmFsc2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGZvcm1Hcm91cFtjb250cm9sLm5hbWVdID0gdGhpcy5mb3JtQnVpbGRlci5ncm91cChjaGVja2JveENvbnRyb2xzKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBIYW5kbGUgYWxsIG90aGVyIGNvbnRyb2xzXHJcbiAgICAgICAgbGV0IGNvbnRyb2xWYWxpZGF0b3JzOiBhbnlbXSA9IFtdO1xyXG5cclxuICAgICAgICBpZiAoY29udHJvbC52YWxpZGF0aW9ucykge1xyXG4gICAgICAgICAgY29udHJvbC52YWxpZGF0aW9ucy5mb3JFYWNoKCh2YWxpZGF0aW9uOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgc3dpdGNoICh2YWxpZGF0aW9uLnZhbGlkYXRvcikge1xyXG4gICAgICAgICAgICAgIGNhc2UgJ3JlcXVpcmVkJzpcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xWYWxpZGF0b3JzLnB1c2goVmFsaWRhdG9ycy5yZXF1aXJlZCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdlbWFpbCc6XHJcbiAgICAgICAgICAgICAgICBjb250cm9sVmFsaWRhdG9ycy5wdXNoKFZhbGlkYXRvcnMuZW1haWwpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnbWluTGVuZ3RoJzpcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xWYWxpZGF0b3JzLnB1c2goVmFsaWRhdG9ycy5taW5MZW5ndGgodmFsaWRhdGlvbi52YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnbWF4TGVuZ3RoJzpcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xWYWxpZGF0b3JzLnB1c2goVmFsaWRhdG9ycy5tYXhMZW5ndGgodmFsaWRhdGlvbi52YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnbWluJzpcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xWYWxpZGF0b3JzLnB1c2goVmFsaWRhdG9ycy5taW4odmFsaWRhdGlvbi52YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnbWF4JzpcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xWYWxpZGF0b3JzLnB1c2goVmFsaWRhdG9ycy5tYXgodmFsaWRhdGlvbi52YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAncGF0dGVybic6XHJcbiAgICAgICAgICAgICAgICBjb250cm9sVmFsaWRhdG9ycy5wdXNoKFZhbGlkYXRvcnMucGF0dGVybih2YWxpZGF0aW9uLnZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAvLyBBZGQgbW9yZSB2YWxpZGF0b3JzIGFzIG5lZWRlZFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvcm1Hcm91cFtjb250cm9sLm5hbWVdID0gW2NvbnRyb2wudmFsdWUgfHwgJycsIGNvbnRyb2xWYWxpZGF0b3JzXTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5keW5hbWljRm9ybSA9IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoZm9ybUdyb3VwKTtcclxuICB9XHJcblxyXG4gIG9uU3VibWl0KCkge1xyXG4gICAgaWYgKHRoaXMuZHluYW1pY0Zvcm0udmFsaWQpIHtcclxuICAgICAgY29uc29sZS5sb2coJ0Zvcm0gU3VibWl0dGVkJywgdGhpcy5keW5hbWljRm9ybS52YWx1ZSk7XHJcbiAgICAgIC8vIFByb2Nlc3MgZm9ybSBkYXRhIGhlcmVcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdGb3JtIGlzIGludmFsaWQnKTtcclxuICAgICAgLy8gTWFyayBhbGwgZmllbGRzIGFzIHRvdWNoZWQgdG8gc2hvdyB2YWxpZGF0aW9uIG1lc3NhZ2VzXHJcbiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5keW5hbWljRm9ybS5jb250cm9scykuZm9yRWFjaChjb250cm9sID0+IHtcclxuICAgICAgICBpZiAoY29udHJvbCBpbnN0YW5jZW9mIEZvcm1Hcm91cCkge1xyXG4gICAgICAgICAgT2JqZWN0LnZhbHVlcyhjb250cm9sLmNvbnRyb2xzKS5mb3JFYWNoKHN1YkNvbnRyb2wgPT4ge1xyXG4gICAgICAgICAgICBzdWJDb250cm9sLm1hcmtBc1RvdWNoZWQoKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb250cm9sLm1hcmtBc1RvdWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0RXJyb3JNZXNzYWdlKGNvbnRyb2w6IGFueSkge1xyXG4gICAgY29uc3QgZm9ybUNvbnRyb2wgPSB0aGlzLmR5bmFtaWNGb3JtLmdldChjb250cm9sLm5hbWUpO1xyXG5cclxuICAgIGlmICghZm9ybUNvbnRyb2wgfHwgIWNvbnRyb2wudmFsaWRhdGlvbnMpIHtcclxuICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IHZhbGlkYXRpb24gb2YgY29udHJvbC52YWxpZGF0aW9ucykge1xyXG4gICAgICBpZiAoZm9ybUNvbnRyb2wuaGFzRXJyb3IodmFsaWRhdGlvbi5uYW1lKSkge1xyXG4gICAgICAgIHJldHVybiB2YWxpZGF0aW9uLm1lc3NhZ2U7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEhhbmRsZSBtaW5sZW5ndGgvbWF4bGVuZ3RoIGVycm9ycyB3aXRoIHRoZWlyIHByb3BlciBlcnJvciBrZXlzXHJcbiAgICAgIGlmICh2YWxpZGF0aW9uLnZhbGlkYXRvciA9PT0gJ21pbkxlbmd0aCcgJiYgZm9ybUNvbnRyb2wuaGFzRXJyb3IoJ21pbmxlbmd0aCcpKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRpb24ubWVzc2FnZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodmFsaWRhdGlvbi52YWxpZGF0b3IgPT09ICdtYXhMZW5ndGgnICYmIGZvcm1Db250cm9sLmhhc0Vycm9yKCdtYXhsZW5ndGgnKSkge1xyXG4gICAgICAgIHJldHVybiB2YWxpZGF0aW9uLm1lc3NhZ2U7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHZhbGlkYXRpb24udmFsaWRhdG9yID09PSAnbWluJyAmJiBmb3JtQ29udHJvbC5oYXNFcnJvcignbWluJykpIHtcclxuICAgICAgICByZXR1cm4gdmFsaWRhdGlvbi5tZXNzYWdlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh2YWxpZGF0aW9uLnZhbGlkYXRvciA9PT0gJ21heCcgJiYgZm9ybUNvbnRyb2wuaGFzRXJyb3IoJ21heCcpKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRpb24ubWVzc2FnZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodmFsaWRhdGlvbi52YWxpZGF0b3IgPT09ICdwYXR0ZXJuJyAmJiBmb3JtQ29udHJvbC5oYXNFcnJvcigncGF0dGVybicpKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRpb24ubWVzc2FnZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiAnJztcclxuICB9XHJcblxyXG4gIGlzQ2hlY2tib3hHcm91cChjb250cm9sOiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBjb250cm9sLnR5cGUgPT09ICdjaGVja2JveC1ncm91cCc7XHJcbiAgfVxyXG59IiwiPGZvcm0gW2Zvcm1Hcm91cF09XCJkeW5hbWljRm9ybVwiIChuZ1N1Ym1pdCk9XCJvblN1Ym1pdCgpXCI+XHJcbiAgPGRpdiAqbmdGb3I9XCJsZXQgY29udHJvbCBvZiBmb3JtU2VydmljZS5mb3JtU3RydWN0dXJlXCI+XHJcbiAgICA8IS0tIFRleHQsIEVtYWlsLCBOdW1iZXIsIFBhc3N3b3JkLCBUZXh0YXJlYSwgRGF0ZSAtLT5cclxuICAgIDxkaXYgKm5nSWY9XCJbJ3RleHQnLCAnZW1haWwnLCAnbnVtYmVyJywgJ3Bhc3N3b3JkJywgJ3RleHRhcmVhJywgJ2RhdGUnXS5pbmNsdWRlcyhjb250cm9sLnR5cGUpXCI+XHJcbiAgICAgIDxsYWJlbD57e2NvbnRyb2wubGFiZWx9fTwvbGFiZWw+XHJcbiAgICAgIDx0ZXh0YXJlYSAqbmdJZj1cImNvbnRyb2wudHlwZSA9PT0gJ3RleHRhcmVhJ1wiIFxyXG4gICAgICAgICAgICAgICAgW2Zvcm1Db250cm9sTmFtZV09XCJjb250cm9sLm5hbWVcIlxyXG4gICAgICAgICAgICAgICAgW3BsYWNlaG9sZGVyXT1cImNvbnRyb2wubGFiZWxcIj48L3RleHRhcmVhPlxyXG4gICAgICA8aW5wdXQgKm5nSWY9XCJjb250cm9sLnR5cGUgIT09ICd0ZXh0YXJlYSdcIiBcclxuICAgICAgICAgICAgIFt0eXBlXT1cImNvbnRyb2wudHlwZVwiIFxyXG4gICAgICAgICAgICAgW2Zvcm1Db250cm9sTmFtZV09XCJjb250cm9sLm5hbWVcIlxyXG4gICAgICAgICAgICAgW3BsYWNlaG9sZGVyXT1cImNvbnRyb2wubGFiZWxcIj5cclxuICAgICAgPHNwYW4gKm5nSWY9XCJkeW5hbWljRm9ybS5jb250cm9sc1tjb250cm9sLm5hbWVdPy5pbnZhbGlkICYmIGR5bmFtaWNGb3JtLmNvbnRyb2xzW2NvbnRyb2wubmFtZV0/LnRvdWNoZWRcIj5cclxuICAgICAgICB7e2dldEVycm9yTWVzc2FnZShjb250cm9sKX19XHJcbiAgICAgIDwvc3Bhbj5cclxuICAgIDwvZGl2PlxyXG5cclxuICAgIDwhLS0gU2VsZWN0IERyb3Bkb3duIC0tPlxyXG4gICAgPGRpdiAqbmdJZj1cImNvbnRyb2wudHlwZSA9PT0gJ3NlbGVjdCdcIj5cclxuICAgICAgPGxhYmVsPnt7Y29udHJvbC5sYWJlbH19PC9sYWJlbD5cclxuICAgICAgPHNlbGVjdCBbZm9ybUNvbnRyb2xOYW1lXT1cImNvbnRyb2wubmFtZVwiPlxyXG4gICAgICAgIDxvcHRpb24gKm5nRm9yPVwibGV0IG9wdGlvbiBvZiBjb250cm9sLm9wdGlvbnNcIiBbdmFsdWVdPVwib3B0aW9uLnZhbHVlXCI+e3tvcHRpb24ubGFiZWx9fTwvb3B0aW9uPlxyXG4gICAgICA8L3NlbGVjdD5cclxuICAgICAgPHNwYW4gKm5nSWY9XCJkeW5hbWljRm9ybS5jb250cm9sc1tjb250cm9sLm5hbWVdPy5pbnZhbGlkICYmIGR5bmFtaWNGb3JtLmNvbnRyb2xzW2NvbnRyb2wubmFtZV0/LnRvdWNoZWRcIj5cclxuICAgICAgICB7e2dldEVycm9yTWVzc2FnZShjb250cm9sKX19XHJcbiAgICAgIDwvc3Bhbj5cclxuICAgIDwvZGl2PlxyXG5cclxuICAgIDwhLS0gUmFkaW8gQnV0dG9ucyAtLT5cclxuICAgIDxkaXYgKm5nSWY9XCJjb250cm9sLnR5cGUgPT09ICdyYWRpbydcIj5cclxuICAgICAgPGxhYmVsPnt7Y29udHJvbC5sYWJlbH19PC9sYWJlbD5cclxuICAgICAgPGRpdiAqbmdGb3I9XCJsZXQgb3B0aW9uIG9mIGNvbnRyb2wub3B0aW9uc1wiIGNsYXNzPVwicmFkaW8tb3B0aW9uXCI+XHJcbiAgICAgICAgPGlucHV0IHR5cGU9XCJyYWRpb1wiIFxyXG4gICAgICAgICAgICAgICBbZm9ybUNvbnRyb2xOYW1lXT1cImNvbnRyb2wubmFtZVwiIFxyXG4gICAgICAgICAgICAgICBbdmFsdWVdPVwib3B0aW9uLnZhbHVlXCJcclxuICAgICAgICAgICAgICAgW2lkXT1cImNvbnRyb2wubmFtZSArIG9wdGlvbi52YWx1ZVwiPlxyXG4gICAgICAgIDxsYWJlbCBbZm9yXT1cImNvbnRyb2wubmFtZSArIG9wdGlvbi52YWx1ZVwiPnt7b3B0aW9uLmxhYmVsfX08L2xhYmVsPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPHNwYW4gKm5nSWY9XCJkeW5hbWljRm9ybS5jb250cm9sc1tjb250cm9sLm5hbWVdPy5pbnZhbGlkICYmIGR5bmFtaWNGb3JtLmNvbnRyb2xzW2NvbnRyb2wubmFtZV0/LnRvdWNoZWRcIj5cclxuICAgICAgICB7e2dldEVycm9yTWVzc2FnZShjb250cm9sKX19XHJcbiAgICAgIDwvc3Bhbj5cclxuICAgIDwvZGl2PlxyXG5cclxuICAgIDwhLS0gU2luZ2xlIENoZWNrYm94IC0tPlxyXG4gICAgPGRpdiAqbmdJZj1cImNvbnRyb2wudHlwZSA9PT0gJ2NoZWNrYm94J1wiPlxyXG4gICAgICA8bGFiZWwgY2xhc3M9XCJjaGVja2JveC1sYWJlbFwiPlxyXG4gICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBbZm9ybUNvbnRyb2xOYW1lXT1cImNvbnRyb2wubmFtZVwiPlxyXG4gICAgICAgIHt7Y29udHJvbC5sYWJlbH19XHJcbiAgICAgIDwvbGFiZWw+XHJcbiAgICA8L2Rpdj5cclxuXHJcbiAgICA8IS0tIENoZWNrYm94IEdyb3VwIC0tPlxyXG4gICAgPGRpdiAqbmdJZj1cImlzQ2hlY2tib3hHcm91cChjb250cm9sKVwiPlxyXG4gICAgICA8bGFiZWw+e3tjb250cm9sLmxhYmVsfX08L2xhYmVsPlxyXG4gICAgICA8ZGl2IGZvcm1Hcm91cE5hbWU9XCJ7e2NvbnRyb2wubmFtZX19XCI+XHJcbiAgICAgICAgPGRpdiAqbmdGb3I9XCJsZXQgb3B0aW9uIG9mIGNvbnRyb2wub3B0aW9uc1wiIGNsYXNzPVwiY2hlY2tib3gtb3B0aW9uXCI+XHJcbiAgICAgICAgICA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgXHJcbiAgICAgICAgICAgICAgICAgW2Zvcm1Db250cm9sTmFtZV09XCJvcHRpb24udmFsdWVcIlxyXG4gICAgICAgICAgICAgICAgIFtpZF09XCJjb250cm9sLm5hbWUgKyBvcHRpb24udmFsdWVcIj5cclxuICAgICAgICAgIDxsYWJlbCBbZm9yXT1cImNvbnRyb2wubmFtZSArIG9wdGlvbi52YWx1ZVwiPnt7b3B0aW9uLmxhYmVsfX08L2xhYmVsPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG4gIDwvZGl2PlxyXG5cclxuICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiBbZGlzYWJsZWRdPVwiZHluYW1pY0Zvcm0uaW52YWxpZFwiPlN1Ym1pdDwvYnV0dG9uPlxyXG48L2Zvcm0+Il19